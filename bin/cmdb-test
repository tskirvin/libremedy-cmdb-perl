#!/usr/bin/perl
# Copyright and license are in the documentation below.

##############################################################################
### Configuration
##############################################################################

## Modify and uncomment this to use user code instead of just system-wide
## modules, or to use development versions.
# use lib '/FULL/PATH/TO/PERL/MODULES';
use lib "/afs/ir/users/t/s/tskirvin/private/work/remedy/libremedy-perl/lib";
use lib "/afs/ir/users/t/s/tskirvin/private/work/remedy/Stanford-Remedy/lib";
use lib "/afs/ir/users/t/s/tskirvin/private/work/remedy/libremedy-cmdb-perl/lib";

## Print debugging information?  Set with '--debug', can be set many times
our $DEBUG = 0;


our @LIMIT = qw/
300430000 301002800 301017200 260600010 230000004 530010700 301518000 400124800
300506400 260600001 301188400 490000100 250100009 200003000 300483500 250000006
530031900 400129700 531900027 400114000 300421900 200000021 260130121 490001289
260000030 300340400 1707000 240001005 200000005 300025400 300151500 240001009
301797500 301016200 230000000 301797300 260800052 400128300 260700003 250000020
400129500 400129600 240000003 260830101 531900030 260000004 250000051 250000075
250000045 300500400 300632000 300505900 301628200 301115000 301186800 260130103
531900028 530024200 301409000 270002051 240000007 1000000162 230000009
400137000 27012011 301686100 8 260100001 300524900 200000033 5 301182000
240000025 200000020 260140117 300500100 531900026 200000012 230000003 260442101
301019900 250000000 400138300 300732800 240001004 260400001 250000108 260800002
400129200 300714900 300557000 300506500 301172600 200000001 300826900 260730102
1000000150 100000115 301797200 301002900 250000015 300506300 300505800
200000028 260130105 250000048 1002 260130109 301016100 250000058
1000000163 530010100 260130110 300516000 300506200 1 260000001 530019500
531900031 490000200 270002010 301019400 200000023 530032000 270002000 300885900
250000046 260130120 301019500 300472500 200003003 260700002 400137700 300927600
301032300 6 260000005 260000107 400124400 300106800 260130111 300589400
260100004 400000010 530014300 1000005927 301004200 250000107 100000093
200000032 300559700 200000022 530001600 530001500 530001800 250000047 530014500
300230700 530034500 260100002 301091600 301188600 531900032 400126800
1000000001 300427300 260100007 530035200 240000004 531900025 400124500 1706900
250400000 301134900 300500600 200000013 260130118 301016000 300448400 230000002
301628300 250000076 300515700 300982300 250000049 1707100 300506000 300000050
260000002 300545200 260000106 300000300 400126900 2 400125000 240001008
400136600 1707300 530032500 530014400 200000003 400127000 301517900 250000019
112 301118000 400124600 300500200 260130100 300040900 301188500 250000070
200000035 301797000 300037600 400065600 250000201 1706300 260130115 260400002
260130108 240000024 270002019 200000006 400127400 301019600 260700009 400136500
490021100 301185300 260100010 260130112 1000001583 400129100 530001700 1707200
400136900 260100015 7 260100009 531900034 179 230000121 250000005 60513
301584100 260000104 530010600 531900033 300367500 301205200 400131300 301017300
530032600 301016900 400131200 260700001 200000026 300506100 300230800 300036900
400137200 301019800 301205100 530010200 300559600 260130107 400124200 400124700
301017000 230000001 300111500 250000050 301797600 400124900 400079600 301016700
260300004 260130113 200000029 400124300 300685700 240000008 400128200 250600002
260100006 531900029 300534000 200000025 400137100 260000000 530031600 260400003
300887100 301016800 263000050 300706800 301089100 260130104 260700004 260000003
400138400 300500300 301071700 301797400 1000000076 270002009 1000000010
250600001 400103900 240001003 263000017 200000004 3 1000001582 301164700
230000122 210000000 4 200000007 240001002 301017100 200000034 301797100

/;

##############################################################################
### Declarations
##############################################################################

use strict;
use warnings;

use Getopt::Long qw/GetOptions/;
use Pod::Usage;
use Remedy;
use Remedy::Form::FormJoin;
use Text::Wrap;

$0 =~ s%.*/%%g;     # Lose the annoying path information
$|++;               # Flush output

use vars qw/$USER $GROUP/;

##############################################################################
### main ()
##############################################################################

my $logger = Remedy::Log->get_logger;

my $parser = new Getopt::Long::Parser;
my $result = $parser->getoptions (
    'd|debug+'      => \$DEBUG,
    'man'           => sub { pod2usage (-verbose=>2) },
    'h|help'        => sub { pod2usage (-verbose=>1) }) || pod2usage (1);
my ($text) = @ARGV;

my $remedy = eval { Remedy->connect ('debug' => $DEBUG) }
    or $logger->logdie ("couldn't connect to database: $@");
$logger->logdie ($@) if $@;

# my $RID = "000000000003698|000000000012487";
# my $RID = "000000000000821|000000000016161";
my $RID = '';
# my $RID = "000000000007351|000000000016191";

my $table = 'BMC.CORE:BMC_ComputerSystem';
# my $table = 'BMC.CORE:BMC_BusinessService';
# my %limit = ('RequestId' => $RID, 'max' => 10, 'limit' => [1,2,3,4,5] );
# my %limit = ('RequestId' => $RID, 'max' => 10, 'limit' => [1,2,3,4,5] );
# my %limit = ('RequestId' => $RID, 'max' => 10, 'limit' => \@LIMIT);
my %limit = ('RequestId' => $RID, 'MAX' => 10);
foreach ($remedy->read ($table, %limit)) {
    print scalar $_->print;
}
exit 0;

##############################################################################
### Documentation
##############################################################################

=head1 NAME

cmdb-clear - clears BaseObject/BaseRelationship tables

=head1 SYNOPSIS

B<cmdb-clear> MDRID REASON

=head1 DESCRIPTION

cmdb-clear takes advantage of the business logic in the table stored in
B<Remedy::Form::> to wipe all data stored in the BaseElement and 
BaseRelationship tables.

Yes, this is deliberately obscure.

=head1 OPTIONS

=over 4

=item B<-h>, B<--help>

Prints out the synopsis information and exits.

=item B<-v>, B<--version>

Prints out the version information and exits.

=back

=head1 EXAMPLES

=head1 REQUIREMENTS

B<Remedy>, B<Remedy::Form::>

=cut

=head1 AUTHOR

Tim Skirvin <tskirvin@stanford.edu>

=head1 LICENSE

Copyright 2009 Board of Trustees, Leland Stanford Jr. University

This program is free software; you may redistribute it and/or modify
it under the same terms as Perl itself.

=cut
